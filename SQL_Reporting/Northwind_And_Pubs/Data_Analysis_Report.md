## NORTHWIND DATABASE ##

The Northwind database is a sample database used by Microsoft to demonstrate the features of some of its products, including SQL Server and Microsoft Access. The database contains the sales data for Northwind Traders, a fictitious specialty foods exportimport company.

## EMPLOYEE ANALYSIS ##

### Number of employees hired each year ###
```sql
select datepart(year, hiredate) as Year, count(*) as Count from employees
group by datepart(year, hiredate)
```
![image](https://user-images.githubusercontent.com/77920592/196151570-52eaf4a3-4e50-4f01-9230-87b25962adf6.png)

### Average age of the employees ###

```sql
select avg(datediff(year, birthdate, getdate())) from employees;
```
![image](https://user-images.githubusercontent.com/77920592/196151642-94360555-eba1-4356-9fe1-3bfc11f54a6c.png)

### Number of employees in different positions ###

```sql
select title, count(*) as Count from employees
group by title;
```
![image](https://user-images.githubusercontent.com/77920592/196151765-448a4d54-1466-4b92-851a-a2db924731e3.png)

### Number of orders processed by each employee ###

```sql
select e.employeeid, e.firstname, e.lastname, count(distinct o.orderid) as OrdersCount
from employees e 
join orders o on e.employeeid = o.employeeid
group by e.employeeid, e.firstname, e.lastname
order by count(distinct o.orderid) desc
```
![image](https://user-images.githubusercontent.com/77920592/196152118-697470b3-f6a9-4a95-a703-ccad7433a147.png)

### Order values processed by each employee ###

```sql
select e.firstname, e.lastname, sum(od.unitprice * quantity) as Sumorders
from employees e 
join orders o on e.employeeid = o.employeeid
join [order details] od on o.orderid = od.orderid
group by e.employeeid, e.firstname, e.lastname
order by sum(od.unitprice * quantity) desc 
```
![image](https://user-images.githubusercontent.com/77920592/196152205-437fbdc4-24e3-4335-91a6-9e1e0cfc3670.png)

### Order values processed by each employee on an annual basis ###

```sql
select datepart(year, orderdate) as Year, e.firstname, e.lastname, sum(od.unitprice * quantity) as Sumorders
from employees e 
join orders o on e.employeeid = o.employeeid
join [order details] od on o.orderid = od.orderid
group by e.employeeid, e.firstname, e.lastname, datepart(year, orderdate)
order by datepart(year, orderdate), sum(od.unitprice * quantity) desc 
```
![image](https://user-images.githubusercontent.com/77920592/196154764-1281fa64-18f7-4421-adde-77c314ca9fc8.png)
![image](https://user-images.githubusercontent.com/77920592/196154862-3a74812c-9aaa-4652-95b3-f53e46371ae6.png)

Northwind hires an average of 3 employees each year and the age of all employees are relatively high, with an average of 66 years old. 
2/3 of its employees are sales representatives, who are the key personnels pushing the business. 
Margaret Peacock is the top performing employees processesing the highest number of order counts with the greatest value, followed by Janet Leverling and Nancy Davolio.
However, when comparing their performances on an annual basis, Janet Leverling overtook Margaret Peacock and became the top performing employees in terms of revenue generation.

## CUSTOMER ANALYSIS ##

### Find the number of customers in different country ###

```sql
select country, count(*) as Count from customers
group by country
order by count desc;
```

### Find the number of orders placed by each customer ###

```sql
select cu.customerid, cu.companyname, count(distinct o.orderid) as OrdersCount
from customers cu 
join orders o on cu.customerid = o.customerid
group by cu.customerid, cu.companyname
order by count(distinct o.orderid) desc
```

### Find the total revenues generated by each customer ###

```sql
select cu.customerid, cu.companyname, sum(od.unitprice*quantity) as TotalValue
from customers cu join orders o on o.customerid = cu.customerid
join [Order Details] od on o.orderid = od.orderid
group by cu.customerid, cu.companyname
order by sum(od.unitprice*quantity) desc
```

## TRANSACTION ANALYSIS ##

### Find the 25th, 50th and 75th percentile values for the revenue (unitprice * quantity) per transaction ###

```sql
select distinct percentile_cont(0.25) within group(order by (unitprice*quantity)) over() as [25th_percentile]
from [order details];
select distinct percentile_cont(0.50) within group(order by (unitprice*quantity)) over() as [25th_percentile]
from [order details];
select distinct percentile_cont(0.75) within group(order by (unitprice*quantity)) over() as [25th_percentile]
from [order details];
```

### Find the average discount value per transaction ###

```sql
select round(avg(discount) * 100.0, 2) as AvgDiscount 
from [order details]

### Find the country origin of the customers who contribute to the most revenue

```sql
select shipcountry, sum(unitprice*quantity) as Revenue,
dense_rank() over(order by sum(unitprice*quantity) desc) as Rank
from orders o join [order details] od on o.orderid = od.orderid
group by shipcountry
```

### Find the top selling product(most quantity) for each category ###

```sql
with cte as
(
select c.categoryname, p.productname, sum(od.quantity) as TotalQuantity,
rank() over(partition by c.categoryname order by sum(od.quantity) desc) as Rank
from [order details] od join products p on od.productid = p.productid 
join categories c on p.categoryid = c.categoryid
group by c.categoryname, p.productname
)
select categoryname, productname, totalquantity
from cte
where rank = 1;
```

## PRODUCTS ANALYSIS ##

### Find the top 3 products by total revenue before discount ###

```sql
with cte as
(
select od.productid, productname, sum(od.unitprice*quantity) as Revenue,
rank() over(order by sum(od.unitprice*quantity) desc) as Rank
from [order details] od join products p on od.productid = p.productid
group by od.productid, productname
)
select productid, productname, revenue from cte
where Rank in (1,2,3)
```

### Find how much are the products in stock in each category worth ###

```sql
select c.categoryid, c.categoryname, sum(p.unitprice*p.unitsinstock) as CategoryTotalValue
from categories c
join products p on c.categoryid = p.categoryid
group by c.categoryid, c.categoryname
```

### Find the total quantity, revenue for each category ###

```sql
select c.categoryid, c.categoryname, sum(od.quantity) as Quantity, sum(od.unitprice*quantity) as Revenue
from [order details] od join products p on od.productid = p.productid 
join categories c on p.categoryid = c.categoryid
group by c.categoryid, c.categoryname
order by sum(od.unitprice*quantity) desc
```

### Find the percentage split of total revenue by category ###

```sql
with cte as
(
select c.categoryname, sum(od.unitprice*quantity) as TotalRevenue
from [order details] od join products p on od.productid = p.productid 
join categories c on p.categoryid = c.categoryid
group by c.categoryname
)
select categoryname, (TotalRevenue * 100.0) / sum(TotalRevenue) over() as Percentage
from cte
order by (TotalRevenue * 100.0) / sum(TotalRevenue) over() desc
```

## SUPPLIER

### Find the total number of products provided by each supplier ###

```sql
select s.companyname, count(P.productid) as ProductsCount
from suppliers s left 
join products p on s.supplierid = p.supplierid
group by s.companyname
```

## FREIGHT COST

### Group all orders based on the Freight column ###

```sql
select 
sum (case when o.freight < 40 then 1 end) as LowFreight,
sum (case when o.freight >= 40 and o.freight < 80 then 1 end) as AvgFreight,
sum (case when o.freight >= 80 then 1 end) as HighFreight
from orders o
```
